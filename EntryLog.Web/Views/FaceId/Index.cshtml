@{
    Layout = "_MainLayout";
    ViewBag.Title = "Face ID";
}

@model EmployeeFaceIdDTO;

<link href="~/css/faceid.css" rel="stylesheet" />

@if (Model != null)
{
    <div class="d-flex align-items-left align-items-md-center flex-column flex-md-row pt-2 pb-4">
        <div>
            <h3 class="fw-bold mb-3">Face ID</h3>
        </div>

        @if (!Model.Active)
        {
            <div class="ms-md-auto py-2 py-md-0">
                <button id="faceid-config-btn" class="btn btn-primary btn-round" onclick="initFaceId()">
                    Configurar
                </button>
            </div>
        }

    </div>


    @if (Model.Active)
    {
        <div class="row">
            <div class="col-md-4">
                <div class="card card-post card-round">
                    <div class="card-body">
                        <div class="d-flex">
                            <div class="avatar avatar-@(Model.Active ? "online" : "offline")">
                                <img src="@Model.Base64Image" alt="..." class="avatar-img rounded-circle">
                            </div>
                            <div class="info-post ms-2">
                                <p class="username">Fecha registro</p>
                                <p class="date text-muted">@Model.RegisterDate</p>
                            </div>
                        </div>
                        <div class="separator-solid"></div>
                        <button class="btn btn-primary btn-rounded btn-sm" data-bs-toggle="collapse" data-bs-target="#faceid-image"
                                aria-expanded="true" aria-controls="faceid-image">
                            Ver foto
                        </button>
                    </div>
                    <div id="faceid-image" class="collapse">
                        <img class="card-img-bottom" src="@Model.Base64Image" alt="Card image cap">
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="row">
            <div id="faceid-info-section"></div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div id="no-configured-alert" class="alert alert-warning alert-dismissible fade show" role="alert">
                    <h6>Face ID no ha sido configurado!</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            </div>
            <div class="col-md-6">
                <div id="faceid-container" class="border-2">
                    <p id="faceid-helper" class="text-sm-start visually-hidden">Acerque el rostro al círculo y mantenga su posición durante 3 segundos</p>
                    <div style="position: relative; display: inline-block;">
                        <video id="video" width="550" height="500" autoplay muted></video>
                        <div id="circle-overlay" class="circle"></div>
                        <div id="countdown-overlay"></div>
                        <div id="loader-overlay" class="d-flex justify-content-center align-items-center">
                            <div class="spinner-border text-white" style="width: 4rem; height: 4rem;">
                                <span class="visually-hidden">Cargando...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @* <div class="col-md-6">
                <div id="detector-data"></div>
            </div> *@
        </div>
    }
}


<!-- Modal Snapshot -->

<div class="modal fade" id="camera-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="camera-modal-title" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="camera-modal-title">Crear Face ID</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container text-center">
                    <div class="row">
                        <div class="col">
                            <canvas id="snapshot" style="position: relative; display: inline-block;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="snapshotAgain()">Reintentar</button>
                <div id="save-faceid-button-container">
                    <button id="save-faceid-button" type="button" class="btn btn-primary">Aprobar</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script src="~/js/faceid.index.js"></script>
}
